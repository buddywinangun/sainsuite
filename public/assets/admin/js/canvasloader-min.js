!function(t){var e,i=function(t,e){void 0===e&&(e={}),this.init(t,e)},s=i.prototype,n=["canvas","vml"],a=["oval","spiral","square","rect","roundRect"],h=/^\#([a-fA-F0-9]{6}|[a-fA-F0-9]{3})$/,r=-1!==navigator.appVersion.indexOf("MSIE")&&8===parseFloat(navigator.appVersion.split("MSIE")[1]),o=!!document.createElement("canvas").getContext,c=!0,d=function(t,e,i){var s;t=document.createElement(t);for(s in i)t[s]=i[s];return void 0!==e&&e.appendChild(t),t},l=function(t,e){for(var i in e)t.style[i]=e[i];return t},u=function(t,e){for(var i in e)t.setAttribute(i,e[i]);return t},f=function(t,e,i,s){t.save(),t.translate(e,i),t.rotate(s),t.translate(-e,-i),t.beginPath()};s.init=function(t,s){"boolean"==typeof s.safeVML&&(c=s.safeVML);try{this.mum=void 0!==document.getElementById(t)?document.getElementById(t):document.body}catch(t){this.mum=document.body}if(s.id=void 0!==s.id?s.id:"canvasLoader",this.cont=d("div",this.mum,{id:s.id}),o)e=n[0],this.can=d("canvas",this.cont),this.con=this.can.getContext("2d"),this.cCan=l(d("canvas",this.cont),{display:"none"}),this.cCon=this.cCan.getContext("2d");else{if(e=n[1],void 0===i.vmlSheet){document.getElementsByTagName("head")[0].appendChild(d("style")),i.vmlSheet=document.styleSheets[document.styleSheets.length-1];var a,h=["group","oval","roundrect","fill"];for(a in h)i.vmlSheet.addRule(h[a],"behavior:url(#default#VML); position:absolute;")}this.vml=d("group",this.cont)}this.setColor(this.color),this.draw(),l(this.cont,{display:"none"})},s.cont={},s.can={},s.con={},s.cCan={},s.cCon={},s.timer={},s.activeId=0,s.diameter=40,s.setDiameter=function(t){this.diameter=Math.round(Math.abs(t)),this.redraw()},s.getDiameter=function(){return this.diameter},s.cRGB={},s.color="#000000",s.setColor=function(t){this.color=h.test(t)?t:"#000000",this.cRGB=this.getRGB(this.color),this.redraw()},s.getColor=function(){return this.color},s.shape=a[0],s.setShape=function(t){for(var e in a)if(t===a[e]){this.shape=t,this.redraw();break}},s.getShape=function(){return this.shape},s.density=40,s.setDensity=function(t){this.density=c&&e===n[1]?Math.round(Math.abs(t))<=40?Math.round(Math.abs(t)):40:Math.round(Math.abs(t)),this.density>360&&(this.density=360),this.activeId=0,this.redraw()},s.getDensity=function(){return this.density},s.range=1.3,s.setRange=function(t){this.range=Math.abs(t),this.redraw()},s.getRange=function(){return this.range},s.speed=2,s.setSpeed=function(t){this.speed=Math.round(Math.abs(t))},s.getSpeed=function(){return this.speed},s.fps=24,s.setFPS=function(t){this.fps=Math.round(Math.abs(t)),this.reset()},s.getFPS=function(){return this.fps},s.getRGB=function(t){return t="#"===t.charAt(0)?t.substring(1,7):t,{r:parseInt(t.substring(0,2),16),g:parseInt(t.substring(2,4),16),b:parseInt(t.substring(4,6),16)}},s.draw=function(){var t,i,s,h,o,c,v,m,p,g=0,b=this.density,y=Math.round(b*this.range),M=0;p=this.cCon;var C=this.diameter;if(e===n[0])for(p.clearRect(0,0,1e3,1e3),u(this.can,{width:C,height:C}),u(this.cCan,{width:C,height:C});g<b;){switch(m=g<=y?1-1/y*g:m=0,v=(c=270-360/b*g)/180*Math.PI,p.fillStyle="rgba("+this.cRGB.r+","+this.cRGB.g+","+this.cRGB.b+","+m.toString()+")",this.shape){case a[0]:case a[1]:t=.07*C,h=.47*C+Math.cos(v)*(.47*C-t)-.47*C,o=.47*C+Math.sin(v)*(.47*C-t)-.47*C,p.beginPath(),this.shape===a[1]?p.arc(.5*C+h,.5*C+o,t*m,0,2*Math.PI,!1):p.arc(.5*C+h,.5*C+o,t,0,2*Math.PI,!1);break;case a[2]:t=.12*C,h=Math.cos(v)*(.47*C-t)+.5*C,o=Math.sin(v)*(.47*C-t)+.5*C,f(p,h,o,v),p.fillRect(h,o-.5*t,t,t);break;case a[3]:case a[4]:s=.27*(i=.3*C),h=Math.cos(v)*(s+.13*(C-s))+.5*C,o=Math.sin(v)*(s+.13*(C-s))+.5*C,f(p,h,o,v),this.shape===a[3]?p.fillRect(h,o-.5*s,i,s):(t=.55*s,p.moveTo(h+t,o-.5*s),p.lineTo(h+i-t,o-.5*s),p.quadraticCurveTo(h+i,o-.5*s,h+i,o-.5*s+t),p.lineTo(h+i,o-.5*s+s-t),p.quadraticCurveTo(h+i,o-.5*s+s,h+i-t,o-.5*s+s),p.lineTo(h+t,o-.5*s+s),p.quadraticCurveTo(h,o-.5*s+s,h,o-.5*s+s-t),p.lineTo(h,o-.5*s+t),p.quadraticCurveTo(h,o-.5*s,h+t,o-.5*s))}p.closePath(),p.fill(),p.restore(),++g}else{switch(l(this.cont,{width:C,height:C}),l(this.vml,{width:C,height:C}),this.shape){case a[0]:case a[1]:v="oval",t=140;break;case a[2]:v="roundrect",t=120;break;case a[3]:case a[4]:v="roundrect",t=300}for(i=s=t,h=500-s,o=.5*-s;g<b;){switch(m=g<=y?1-1/y*g:m=0,c=270-360/b*g,this.shape){case a[1]:i=s=t*m,h=500-.5*t-t*m*.5,o=.5*(t-t*m);break;case a[0]:case a[2]:r&&(o=0,this.shape===a[2]&&(h=500-.5*s));break;case a[3]:case a[4]:s=.28*(i=.95*t),r?(h=0,o=500-.5*s):(h=500-i,o=.5*-s),M=this.shape===a[4]?.6:0}p=u(l(d("group",this.vml),{width:1e3,height:1e3,rotation:c}),{coordsize:"1000,1000",coordorigin:"-500,-500"}),p=l(d(v,p,{stroked:!1,arcSize:M}),{width:i,height:s,top:o,left:h}),d("fill",p,{color:this.color,opacity:m}),++g}}this.tick(!0)},s.clean=function(){if(e===n[0])this.con.clearRect(0,0,1e3,1e3);else{var t=this.vml;if(t.hasChildNodes())for(;t.childNodes.length>=1;)t.removeChild(t.firstChild)}},s.redraw=function(){this.clean(),this.draw()},s.reset=function(){"number"==typeof this.timer&&(this.hide(),this.show())},s.tick=function(t){var i=this.con,s=this.diameter;t||(this.activeId+=360/this.density*this.speed),e===n[0]?(i.clearRect(0,0,s,s),f(i,.5*s,.5*s,this.activeId/180*Math.PI),i.drawImage(this.cCan,0,0,s,s),i.restore()):(this.activeId>=360&&(this.activeId-=360),l(this.vml,{rotation:this.activeId}))},s.show=function(){if("number"!=typeof this.timer){var t=this;this.timer=self.setInterval((function(){t.tick()}),Math.round(1e3/this.fps)),l(this.cont,{display:"block"})}},s.hide=function(){"number"==typeof this.timer&&(clearInterval(this.timer),delete this.timer,l(this.cont,{display:"none"}))},s.kill=function(){var t=this.cont;for(var i in"number"==typeof this.timer&&this.hide(),e===n[0]?(t.removeChild(this.can),t.removeChild(this.cCan)):t.removeChild(this.vml),this)delete this[i]},t.CanvasLoader=i}(window);